---
title: "The Incomparable Radio Network — In Numbers"
date: "`r format(Sys.time(), '%F %R', tz = 'UTC', usetz = T)`"
author: "Lukas — @jemus42"
output:
  rmdformats::readthedown:
    highlight: kate
    self_contained: false
---

```{r knitr_init, echo=FALSE, cache=FALSE, include=FALSE}
#### Paackages ####
library(knitr)
library(rmdformats)
library(readr)
library(ggplot2)
library(magrittr)
library(dplyr)
library(lubridate)
library(tidyr)
library(DT)
library(formattable)
library(scales)
library(viridis)
library(stringr)
library(tadaatoolbox)
library(ggrepel)
library(plotly)

#### Global options ####
options(max.print = "75")
opts_chunk$set(echo    = FALSE,
	             cache   = FALSE,
               prompt  = FALSE,
               tidy    = TRUE,
               comment = NA,
               message = FALSE,
               warning = FALSE)
opts_knit$set(width = 75)

#### Data prep ####
incomparable_master      <- readRDS(file.path(data_dir, "incomparable_master.rds"))
incomparable_master_wide <- readRDS(file.path(data_dir, "incomparable_master_wide.rds"))

shows <- incomparable_master_wide %>% group_by(podcast) %>% tally() %>% arrange(desc(n)) %>% extract2("podcast")

incomparable_master_wide %<>%
  mutate(podcast = factor(podcast, levels = shows, ordered = T))

incomparable_master %<>%
  mutate(podcast = factor(podcast, levels = shows, ordered = T))

#### Plot presets ####
template_background <- element_rect(fill = "#fcfcfc", color = "#fcfcfc")

theme_background <- 
  theme(panel.background  = template_background,
        plot.background   = template_background,
        legend.background = template_background)

theme_breaks_x <-
  theme(panel.grid.major.x = element_line(size = .1, color = "black"),
        panel.grid.minor.x = element_line(size = .1, color = "black", linetype = "dotted"))
  
theme_breaks_y <-   
  theme(panel.grid.major.y = element_line(size = .1, color = "black"),
        panel.grid.minor.y = element_line(size = .1, color = "black", linetype = "dotted"))

```

[The Incomparable Radio Network](https://www.theincomparable.com/) spans **`r incomparable_master_wide$podcast %>% unique %>% length()`** shows (including the [Bonus Track](https://www.theincomparable.com/bonustrack/), but *not* including the [Greatest Hits feed](https://www.theincomparable.com/best)), **`r incomparable_master$person %>% unique %>% length()`** people and a combined runtime of over **`r incomparable_master_wide$duration %>% sum() %>% divide_by(60) %>% divide_by(24) %>% floor`** days spread across **`r nrow(incomparable_master_wide)` episodes**.  
That's quite a lot.

This data is up to date up until **`r max(incomparable_master_wide$date)`** and updates automagically whenever I tell it to.  
See [the repository](https://github.com/jemus42/theincompaRable#about) for a note on how this analysis started. And the code. And stuff.

# Overview

```{r master_shows}
incomparable_master_wide %>%
  group_by(podcast) %>%
  summarize(first_aired = min(date), last_aired = max(date), episodes = n(),
            primary_hosts = modus(host)) %>%
  arrange(desc(episodes)) %>%
  datatable(colnames = c("Show", "First Aired", "Last Aired", "# of Episodes", "Most Frequent Host(s)")) %>%
  formatDate(columns = c(2, 3))
```

# Shows

## Episodes Count (Total)

```{r shows_episodes}
incomparable_master %>%
  group_by(podcast) %>%
  summarize(n = length(unique(number))) %>%
  ggplot(aes(x = reorder(podcast, n), weight = n)) +
  geom_bar() +
  coord_flip() +
  scale_y_continuous(breaks = seq(0, 1000, 50),
                     minor_breaks = seq(0, 1000, 10)) +
  labs(x = "Show", y = "# of Episodes") +
  theme_background +
  theme_breaks_x

incomparable_master %>%
  group_by(podcast) %>%
  summarize(n = length(unique(number))) %>%
  arrange(desc(n)) %>%
  datatable(colnames = c("Show", "# of Episodes"))
```

## Episodes per Year

### All Shows

```{r show_episodes_year_total}
incomparable_master_wide %>%
  group_by(podcast, year) %>%
  tally %>%
  ggplot(aes(x = year, weight = n, fill = podcast)) +
  geom_bar() +
  scale_y_continuous(breaks = seq(0, 1000, 100),
                     minor_breaks = seq(0, 1000, 25)) +
  scale_fill_viridis(discrete = T) +
  labs(x = "Year", y = "# of Episodes", fill = "Show") +
  theme_background +
  theme_breaks_y +
  theme(legend.key.size = unit(.5, "cm"))

incomparable_master_wide %>%
  group_by(year) %>%
  tally %>%
  arrange(desc(year)) %>%
  datatable(colnames = c("Year", "# of Episodes"))
```

### Per Show

```{r show_episodes_year, fig.height=8}
incomparable_master_wide %>%
  group_by(podcast, year) %>%
  summarize(n = length(unique(number))) %>%
  ggplot(aes(x = reorder(podcast, n), weight = n)) +
  geom_bar() +
  coord_flip() +
  facet_wrap(~year) +
  labs(x = "Show", y = "# of Episodes") +
  theme_background +
  theme_breaks_x

incomparable_master %>%
  group_by(podcast, year) %>%
  summarize(n = length(unique(number))) %>%
  arrange(desc(n)) %>%
  datatable(colnames = c("Show", "Year", "# of Episodes"))
```

## Episodes per Week

```{r show_episodes_lifetime_ep}
incomparable_master_wide %>%
  filter(year >= 2010) %>%
  group_by(podcast) %>%
  summarize(first_aired = min(date),
            last_aired = max(date),
            episodes = length(unique(number))) %>%
  mutate(lifetime_weeks = as.numeric(difftime(last_aired, first_aired, units = "weeks")),
         episodes_per_week = episodes / lifetime_weeks) %>%
  {
    ggplot(data = ., aes(x = episodes_per_week, label = podcast)) +
    geom_histogram(binwidth = .05, fill = "lightblue", color = "black") +
    geom_label_repel(y = 1, force = 6, size = 3) +
    geom_vline(xintercept = mean(.$episodes_per_week), linetype = "dotted") +
    labs(title = "The Incomparable Radio Network\nShow Lifetime and Weekly Output\n(2010 - Now)",
         x = "Average # of Episodes per Week", y = "Count") +
    theme_background +
    theme_breaks_y
  }

incomparable_master_wide %>%
  filter(year >= 2010) %>%
  group_by(podcast) %>%
  summarize(first_aired = min(date),
            last_aired = max(date),
            episodes = length(unique(number)),
            duration = sum(duration)) %>%
  mutate(lifetime_weeks = as.numeric(difftime(last_aired, first_aired, units = "weeks")),
         episodes_per_week = episodes / lifetime_weeks,
         duration_per_week = duration / lifetime_weeks) %>%
  ggplot(aes(x = lifetime_weeks, y = episodes_per_week)) +
  geom_point() +
  geom_label_repel(aes(label = podcast), size = 3) +
  geom_hline(aes(yintercept = mean(episodes_per_week)), linetype = "dotted", color = "blue") +
  geom_vline(aes(xintercept = mean(lifetime_weeks)), linetype = "dotted", color = "blue") +
  labs(title = "The Incomparable Radio Network\nShow Lifetime and Weekly Output\n(2010 - Now)",
       x = "Lifetime of Podcast in Weeks", y = "Average # of Episodes per Week") +
    theme_background +
    theme_breaks_y

incomparable_master_wide %>%
  filter(year >= 2010) %>%
  group_by(podcast) %>%
  summarize(first_aired = min(date),
            last_aired = max(date),
            episodes = length(unique(number)),
            duration = sum(duration)) %>%
  mutate(lifetime_weeks = as.numeric(difftime(last_aired, first_aired, units = "weeks")),
         episodes_per_week = episodes / lifetime_weeks,
         duration_per_week = duration / lifetime_weeks) %>%
  datatable(colnames = c("Show", "First Aired", "Last Aired", 
                         "# of Episodes", "Duration (min)", "Age (weeks)", 
                         "Episodes per Week", "Duration per Week")) %>%
  formatDate(columns = c(2, 3)) %>%
  formatRound(columns = 4:8)
```


# Runtimes

## Overall Runtimes

```{r runtimes_histogram}
ggplot(incomparable_master_wide, aes(x = duration, fill = podcast)) +
geom_histogram(binwidth = 5) +
scale_x_continuous(breaks = seq(0, 1000, 20),
                   minor_breaks = seq(0, 1000, 5)) +
scale_fill_viridis(discrete = T) +
labs(x = "Duration (mins)", y = "Count", fill = "Show") +
theme_background +
theme_breaks_x +
theme(legend.key.size = unit(.5, "cm"))
```

## Runtime per Show per Episode

You can manually select shows from the list to the right, mousover reveals episode info.

```{r runtimes_show_episode_plotly}
incomparable_master_wide %>%
  arrange(date) %>%
  mutate(num_show = seq_along(number),
         podcast = factor(podcast, levels = rev(shows), ordered = T)) %>%
  plot_ly(data = ., x = num_show, y = duration, mode = "markers", color = podcast,
          text = paste0("<b>", podcast, "</b>: ", number, "<br />", title, 
                        "<br /><b>Published</b>: ", date,
                        "<br /><b>Duration</b>: ", round(duration, 2), " minutes",
                        "<br /><b>Host</b>: ", host, "<br /><b>Guests</b>:<br />", 
                        str_replace_all(guest, ", ", "<br />")),
          hoverinfo = "text") %>%
  layout(xaxis = list(title = "Total Episode #"), yaxis = list(title = "Duration (mins)"),
         paper_bgcolor = "#fcfcfc", plot_bgcolor = "#fcfcfc")
```


## Total Runtime by Show

```{r runtimes_total_show}
incomparable_master_wide %>%
  group_by(podcast) %>%
  summarize(episodes = length(unique(number)),
            hours    = round(sum(duration)/60, 2),
            days     = round(hours/60, 2)) %>%
  arrange(desc(episodes)) %>%
  {
    ggplot(., aes(x = reorder(podcast, hours), weight = hours)) +
    geom_bar() +
    coord_flip() +
    scale_y_continuous(breaks = seq(0, max(.$hours), 50)) +
    labs(x = "Show", y = "Hours") +
    theme_background +
    theme_breaks_x
  }

incomparable_master_wide %>%
  group_by(podcast) %>%
  summarize(episodes = length(unique(number)),
            hours    = round(sum(duration)/60, 2),
            days     = round(hours/60, 2)) %>%
  arrange(desc(episodes)) %>%
  datatable(colnames = c("Show", "# of Episodes", "Hours", "Days"))
```

## Average Runtime per Show

```{r runtimes_avg_show}
incomparable_master_wide %>% 
  group_by(podcast) %>%
  summarize(mean = mean(duration),
            upper = mean + confint_t(duration),
            lower = mean - confint_t(duration)) %>%
  ungroup %>%
  {
    ggplot(., aes(x = reorder(podcast, mean), y = mean)) +
    geom_errorbar(aes(y = mean, ymin = lower, ymax = upper), size = 1, width = .5) +
    geom_point(aes(y = mean), color = "red", size = 1) +
    geom_hline(aes(yintercept = mean(mean)), linetype = "dotted", color = "red") +
    coord_flip() + 
    scale_y_continuous(breaks = seq(0, max(.$upper) + 30, 15), 
                     minor_breaks = seq(0, max(.$upper) + 30, 5)) +
    expand_limits(y = 0) +
    labs(title = "Average Show Runtime\nwith CI and Global Average (red dotted)",
         x = "Show", y = "Average Runtime (mins) + 95% Confidence Interval") +
    theme_background +
    theme_breaks_x
  }

incomparable_master_wide %>% 
  group_by(podcast) %>%
  mutate(duration_avg = mean(duration)) %>%
  {
    ggplot(., aes(x = reorder(podcast, duration_avg), y = duration)) +
    geom_violin() +
    stat_summary(fun.y = mean, geom = "point", color = "black", size = 2) +
    stat_summary(fun.y = mean, geom = "point", color = "red") +
    geom_hline(aes(yintercept = mean(duration)), linetype = "dotted", color = "red") +
    coord_flip() + 
    scale_y_continuous(breaks = seq(0, max(.$duration) + 30, 15), 
                     minor_breaks = seq(0, max(.$duration) + 30, 5)) +
    expand_limits(y = 0) +
    labs(title = "Show Runtimes\nas Violin Plot and Global Average (red dotted)",
         x = "Show", y = "Runtime (mins)") +
    theme_background +
    theme_breaks_x
  }

incomparable_master_wide %>%
  group_by(podcast) %>%
  summarize(min = round(min(duration), 2),
            mean = round(mean(duration), 2),
            median = round(median(duration), 2),
            max = round(max(duration), 2)) %>%
  arrange(desc(mean)) %>%
  datatable(colnames = c("Show", "Minum", "Mean", "Median", "Maximum"), 
            caption = "All values in minutes")
```

# People

## Appearances in Total

```{r people_appearances, fig.height=7}
incomparable_master %>%
  group_by(role, person) %>%
  tally %>% 
  arrange(person) %>%
  filter(person != "None") %>%
  group_by(person) %>%
  mutate(n_total = sum(n)) %>%
  ungroup() %>%
  filter(n > 2) %>% 
  {
    ggplot(., aes(x = reorder(person, n_total), weight = n, fill = role)) +
    geom_bar() +
    coord_flip() +
    scale_y_continuous(breaks = seq(0, max(.$n_total), 50),
                       minor_breaks = seq(0, max(.$n_total), 10)) +
    scale_fill_brewer(palette = "Set1") +
    labs(x = "Person (3 Appearances Minimum)", y = "Episodes", fill = "Role") +
    theme_background + 
    theme(legend.position = "top") +
    theme_breaks_x
  }

incomparable_master %>%
  group_by(role, person) %>%
  tally %>% 
  spread(role, n) %>%
  replace_na(list(guest = 0, host = 0)) %>%
  mutate(total = guest + host) %>%
  ungroup() %>%
  select(person, total, host, guest) %>%
  arrange(desc(total)) %>%
  datatable(colnames = c("Person", "Apperances Total", "As Host", "As Guest"))
```

## Appearances by Category

```{r people_categories}
categories <- incomparable_master %>% group_by(category) %>% tally %>%
                arrange(desc(n)) %>% filter(category != "Not provided") %>% extract2("category")

incomparable_master %>%
  group_by(category, person) %>%
  tally %>%
  filter(category != "Not provided") %>%
  group_by(category, person) %>%
  summarize(n = sum(n)) %>%
  arrange(desc(n)) %>%
  group_by(person) %>%
  mutate(n_total = sum(n)) %>%
  ungroup %>%
  filter(n_total > 3) %>%
  mutate(n_rel = (n/n_total) * 100,
         category = factor(category, levels = categories, ordered = T)) %>%
  ggplot(aes(x = reorder(person, n_total), weight = n_rel, fill = category)) +
  geom_bar(color = "black", width = 1) +
  coord_flip() +
  scale_fill_brewer(palette = "Set1") +
  labs(title = "Relative # of Appearances by Category\nLimited to 3 Appearances Minimum",
       x = "Person (Sorted by Appearances)", y = "Percentage", fill = "Category") +
  theme_background

incomparable_master %>%
  group_by(category, person) %>%
  tally %>%
  filter(category != "Not provided") %>%
  group_by(category, person) %>%
  summarize(n = sum(n)) %>%
  arrange(desc(n)) %>%
  group_by(person) %>%
  mutate(n_total = sum(n)) %>%
  ungroup %>%
  mutate(n_rel = round((n/n_total) * 100, 2),
         category = factor(category, levels = categories, ordered = T)) %>%
  datatable(colnames = c("Show", "person", "Appearances", "Total (per Person)", "% per Category"))
```


# Acknowledgements

- Thanks to Jason for setting up the `stats.txt` files I parsed for the data.
- Thanks to [Juba](https://twitter.com/lapply) for the [RMarkdown template](https://github.com/juba/rmdformats)

# Related Documents

- [The main show](http://stats.jemu.name/theincomparable/results_incomparable.html)
- [Missing data](http://stats.jemu.name/theincomparable/missings.html)
- [All shows, raw data](http://stats.jemu.name/theincomparable/incomparable_raw.html)
