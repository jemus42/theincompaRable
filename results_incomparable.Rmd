---
title: "The Incomparable Podcast — In Numbers"
date: "`r format(Sys.time(), '%F %R', tz = 'UTC', usetz = T)`"
author: "Lukas — @jemus42"
output:
  rmdformats::readthedown:
    highlight: kate
---

```{r knitr_init, echo=FALSE, cache=FALSE, include=FALSE}
library(knitr)
library(rmdformats)
library(readr)
library(ggplot2)
library(magrittr)
library(dplyr)
library(lubridate)
library(tidyr)
library(DT)
library(formattable)
#library(svglite)
library(viridis)

## Global options
options(max.print = "75")
opts_chunk$set(echo    = FALSE,
	             cache   = FALSE,
               prompt  = FALSE,
               tidy    = TRUE,
               comment = NA,
               message = FALSE,
               warning = FALSE
             # dev = "svglite",
             # fig.ext = ".svg"
             )
opts_knit$set(width = 90)

incomparable <- readRDS("data/incomparable.rds")

incomparable %<>% 
  select(number, date, year, month, weekday, duration, title, host, guest)

## labels ##
duration_mins <- "Duration (mins)"
```

Note: This is a work in progress, and thise document is only a preview.  
I have **a lot** in mind for this project, but I *really really should be studying* right now.

# Introduction

Well, [Jason Snell tweeted](https://twitter.com/jsnell/status/700864025949655040) a graph of The Incomparable runtimes.  
As a big fan of the podcast and an aspiring nerd, [I asked for the data, obviously](https://twitter.com/Jemus42/status/700864609083850753).  
I was happy to [receive his .numbers file](https://twitter.com/jsnell/status/700864809537970176), but unfortunately [it only contained two variables](https://twitter.com/Jemus42/status/700870531697004544) - the two needed for the plot.  
Jason replied [he could get more metadata if I liked](https://twitter.com/jsnell/status/700870702367318017) and since I **really really would like** that, I rushed to set up [this repository](https://github.com/jemus42/theincompaRable) and put on my data-pants.  
A short time after that, [Jason delivered magnificiently](https://twitter.com/jsnell/status/700882298795765761).  
And now my analysis begins.

# Full Data in a Boring Table

It's not so boring if you consider the filterable columns, after all.

```{r fulltable}
incomparable %>%
  group_by(title) %>%
  mutate(guest_position = paste("guest_", 1:length(guest))) %>%
  spread(key = guest_position, value = guest) %>%
  datatable(filter = "top", options = list(pageLength = 5, autoWidth = TRUE)) %>%
  formatDate(columns = "date", method = "toLocaleDateString") %>%
  formatRound(columns = "duration", digits = 2)
```


# Episodes Counts

## Episodes per Month / Year

```{r episodes_monthyear}
incomparable %>%
  mutate(month = factor(month, levels = rev(levels(month)))) %>%
  ggplot(aes(x = month)) +
  geom_bar() +
  facet_grid(.~year) +
  coord_flip() +
  labs(y = "# of Episodes", x = "") +
  theme_bw()
```

## Episodes per Month

```{r episodes_month}
incomparable %>%
  ggplot(aes(x = month)) +
  geom_bar() +
  labs(y = "# of Episodes", x = "") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, vjust = .5))
```

# Runtime

```{r runtime_}
ggplot(data = incomparable, aes(x = duration)) +
  geom_histogram(aes(fill = ..count..), binwidth = 5, color = "black") +
  scale_x_continuous(breaks = seq(0, max(incomparable$duration), 25)) +
  scale_fill_viridis(option = "magma") +
  labs(title = "The Incomparable Podcast\nShow Duration",
       x = duration_mins) +
  theme_bw()


hosts <- incomparable %>% group_by(host) %>% tally() %>% arrange(desc(n)) %>% extract2("host")
incomparable %>%
  mutate(host = factor(host, levels = hosts, ordered = TRUE)) %>%
  ggplot(aes(x = number, y = duration, colour = host)) +
  geom_point(size = 2, color = "black") +
  geom_point() +
  labs(title = "The Incomparable Podcast\nShow Duration",
       x = "Episode #", y = duration_mins, color = "Host") +
  scale_color_brewer(palette = "Set1") +
  theme_bw()
```

## Runtime by Host

```{r runtime_by_host}
ggplot(data = incomparable, aes(x = reorder(host, duration), y = duration)) +
  geom_boxplot() +
  coord_flip() +
  labs(title = "",
       x = "Host (first listed)", y = duration_mins) +
  theme_bw()
```

## Runtime over Time

### Over Years

```{r runtime_years}
ggplot(data = incomparable, aes(x = year, y = duration)) +
  geom_boxplot() +
  labs(x = "", y = duration_mins) +
  theme_bw()
```

### Over Years/Months

```{r runtime_yearmonth, fig.height=8}
incomparable %>%
  mutate(month = factor(month, levels = rev(levels(month)))) %>%
  ggplot(aes(x = month, y = duration)) +
  geom_boxplot() +
  coord_flip() +
  facet_wrap(~year, ncol = 3) +
  theme_bw() +
  labs(y = duration_mins, x = "")
```

### Weekdays

```{r runtime_wday}
ggplot(data = incomparable, aes(x = weekday, y = duration)) +
  geom_boxplot() +
  labs(x = "", y = duration_mins) +
  theme_bw()
```

# Guests

```{r guests, fig.height=9}
incomparable %>%
  group_by(guest) %>%
  tally %>%
  arrange(desc(n)) %>%
  ggplot(aes(x = reorder(guest, n), weight = n)) +
  geom_bar() +
  coord_flip() +
  labs(title = "The Incomparable Podcast\nGuest Appearances",
       x = "Guest", y = "# of Episodes") +
  theme_bw()

incomparable %>%
  group_by(guest) %>%
  summarize(n = n(), airtime_total = round(sum(duration), 2)) %>%
  arrange(desc(n)) %>%
  ungroup %>%
  mutate(perc_episodes = round((n/max(incomparable$number)) * 100, 2),
         perc_guests    = round((n/sum(n)) * 100, 2),
         perc_airtime = round(airtime_total/sum(incomparable$duration) * 100, 2)) %>%
  select(-airtime_total) %>%
  datatable(colnames = c("Guest", "Episodes", "Episode %", 
                         "% of Guests", "% of Guests by Airtime"))
```

# Acknowledgements

- Thanks to Jason for setting up the `stats.txt` files I parsed for the data.
- Thanks to [Juba](https://twitter.com/lapply) for the [RMarkdown template](https://github.com/juba/rmdformats)
